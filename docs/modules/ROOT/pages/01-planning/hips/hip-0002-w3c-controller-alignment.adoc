= HIP-002: Hedera DID Method v2.0: W3C Controller Alignment - Draft

[cols="1,1"]
|===

|*Author:* |Jakub Sydor <@Harasz>, Pablo Buitrago <@ChangoBuitrago>
|*Working-group:* |Micha Roon <@drgorb>, Mahir Senturk <@mhrsntrk>, Gabriele Morelli <@gabomorelli>
|*Requested-by:* |THA
|*Type:* |Standards Track
|*Category:* |Application
|*Needs-council-approval:* |Yes
|*Status:* |Draft
|*Created:* |2025-04-16
|*Discussions-to:* | link:https://github.com/hashgraph/hedera-improvement-proposal/discussions/XXX[https://github.com/hashgraph/hedera-improvement-proposal/discussions/XXX]
|===

== Abstract

This HIP proposes *version 2.0* of the Hedera DID Method (`did:hedera`), designed for full alignment with the W3C Decentralized Identifiers (DIDs) v1.0 specification regarding controller management. While retaining the *existing v1.0 DID identifier format* (`did:hedera:<network>:<base58-key>_<topic-id>`), v2.0 fundamentally changes the authorization model. The `<base58-key>` component, typically derived from the initial creation key, serves *strictly as part of the unique identifier* and *does not* grant ongoing control authority under v2.0 rules. Instead, v2.0 mandates the use of the `controller` property within the DID document as the sole source of authority. Control operations (like updates or deactivations) are authorized via W3C-compliant *cryptographic proofs* generated by keys associated with the designated `controller`(s) and included in Hedera Consensus Service (HCS) messages. This enhances flexibility, enables multi-controller scenarios, simplifies key rotation, increases interoperability, and aligns Hedera DIDs with global standards. *This version's ruleset is intentionally not backwards compatible with the v1.0 Hedera DID Method specification.*

== Motivation

Version 1.0 of the Hedera DID Method established a functional DID method on Hedera using HCS but tied DID control rigidly to the key embedded in the identifier (referred to as `#did-root-key` logic). This deviated from the standard W3C controller model, creating significant limitations:

. *Deviation from W3C Standard:* Hindered interoperability with standard DID tools, libraries, and platforms expecting the `controller` property to define authority.
. *Rigid Control:* Made rotation of the primary controlling key difficult or impossible without changing the DID identifier itself, complicating security best practices and delegation scenarios.
. *Limited Multi-Controller Support:* The v1.0 model's focus on a single identifier-linked key made native support for multiple controllers, common in organizational or delegated scenarios, cumbersome.

Hedera DID Method v2.0 aims to rectify these issues by fully adopting the standard W3C controller pattern for authorization. This change occurs *while retaining the established v1.0 identifier format* to ensure naming continuity for existing DID concepts on Hedera. The result is a more flexible, robust, secure, and interoperable DID method aligned with global standards.

== Rationale

The transition to v2.0 focuses on aligning the *authorization and control logic* with W3C DID Core v1.0 principles, separating the identifier string from the control mechanism, while preserving the existing DID identifier structure to avoid disrupting established naming conventions.

*Key Design Decisions for v2.0:*

. *Retain v1.0 Identifier Format:* The DID format remains `did:hedera:<network>:<base58-key>_<topic-id>`. The `<base58-key>` provides a stable identifier component linked to the DID's origin but is explicitly *decoupled* from ongoing authorization rights in v2.0.
. *W3C Controller Model:* Adopt the `controller` property within the DID Document as the *sole mechanism* for defining authorization to manage the DID. The v1.0 concept of the embedded key (`#did-root-key` derived from `<base58-key>`) having special, inherent control privileges post-creation is removed.
. *Proof-Based Authorization:* DID operations (Create, Update, Revoke properties, Deactivate) submitted via HCS require a cryptographic `proof` (e.g., `Ed25519Signature2020`) included within the HCS message envelope. This proof MUST be verifiable against a verification method authorized by the DID's designated `controller`(s).
. *HCS as Transport Layer:* HCS remains the underlying transport, providing immutable, timestamped ordering for DID operation messages via the topic identified by `did-topic-id`. However, HCS topic permissions (`submitKey`) are distinct from DID controller authorization.
. *Clear Versioning (Ruleset):* Explicitly define this as the *v2.0* ruleset, which is *not backwards compatible* with v1.0 rules. Resolvers and applications need to interpret HCS messages according to the ruleset version applicable to the DID (potentially determined by inspection of messages or external context, TBD).

== User stories

* As a DID Controller, I want to assign multiple DIDs (belonging to other individuals or organizations) as controllers of my DID so that they can manage it on my behalf according to W3C standards.
* As a DID Controller, I want to rotate the keys associated with controlling my DID without changing the DID identifier itself, adhering to security best practices.
* As an application developer, I want to use a Hedera DID method that is fully compliant with the W3C DID Core controller specification for seamless interoperability with standard DID libraries and tools.
* As a DID Subject, I want my DID identifier to remain stable and persistent, even if the underlying controlling keys or authorities change over time.

== Specification

The detailed specification for Hedera DID Method v2.0 is currently under development and review. The draft specification and ongoing discussions can be found in the pull requests section of the dedicated repository: link:https://github.com/Swiss-Digital-Assets-Institute/did-method/pulls[https://github.com/Swiss-Digital-Assets-Institute/did-method/pulls].

== Backwards Compatibility

This specification defines the ruleset for Hedera DID Method *v2.0*. It is intentionally *not backwards compatible* with the v1.0 ruleset due to the fundamental change in the authorization model (from identifier-linked key to controller property and proofs).

Resolvers and applications interacting with `did:hedera` DIDs will need to determine the applicable version (v1.0 or v2.0) and apply the corresponding ruleset for interpretation and validation. Mechanisms for version discovery are outside the scope of this HIP but might involve inspecting message formats or relying on the creation context of the DID.

== Security Implications

The security model for Hedera DID Method v2.0 relies on the inherent security of the Hedera network (via HCS) and the robustness of the W3C controller model and cryptographic proofs.

. *Identifier Component Roles (v2.0 Rule):*
* *Crucial Distinction:* The `<base58-key>` component within the DID identifier string (`did:hedera:<network>:<base58-key>_<topic-id>`) serves *only as part of the unique identifier* after the initial creation operation. It *does not grant* ongoing control authority or authorization privileges for managing the DID document under v2.0 rules. Control is solely determined by the `controller` property within the DID document and verified via the `proof` mechanism. Misunderstanding this is a security risk.

. *Controller Authority & Compromise:*
* *Primary Trust Anchor:* The security of a v2.0 Hedera DID rests primarily on the security of the DID(s) designated in its `controller` property and their associated cryptographic keys. Control authority is explicitly defined by this property.
* *Controller Compromise:* The most significant threat is the compromise of a designated `controller`'s keys. An attacker gaining control of a controller gains full authority to modify (including changing the controller) or deactivate the Hedera DID documents managed by it.
* *Key Management:* Robust key management practices (secure generation, storage, rotation, revocation) for all keys associated with `controller` DIDs are essential for maintaining the security of the Hedera DIDs they control.

. *HCS Topic Interaction & Access Control:*
* *`submitKey` Role (Network Permission):* The HCS topic `submitKey` controls the *network-level permission* to submit messages (valid or invalid) to the DID's associated topic. Compromising the `submitKey` allows an attacker to potentially disrupt the DID by submitting spam or malformed messages (DoS risk, increased resolution cost).
* *`controller` Proof Role (Logical Authorization):* The `submitKey` *does not* grant the ability to submit *validly authorized* state changes. Logical authorization to modify the DID state requires a valid cryptographic `proof` generated by the DID's `controller`.
* *Distinct Controls:* Implementers and users must understand the clear separation between HCS topic write access (`submitKey`) and DID logical control (`controller` proof).

. *Validation Responsibility:*
* Neither Hedera network nodes nor standard mirror nodes validate DID document semantics or controller proofs. This validation *must* be performed by DID resolvers and client applications according to the v2.0 specification rules (verifying proofs against the controller's keys). Failure to validate proofs correctly breaks the security model.

== How to Teach This

Effective education for Hedera DID Method v2.0 should focus on its W3C controller alignment and the separation of identifier from control. Guidance for documentation, tutorials, and SDKs should emphasize:

* *W3C Controller Authority:* Clearly state that the `controller` property in the DID Document exclusively defines who can authorize changes, aligning with W3C DID Core standards.
* *Identifier vs. Control:* Explicitly teach that the `<base58-key>` component in the DID string (`did:hedera:<network>:<base58-key>_<topic-id>`) is *part of the identifier only* and grants *no* control rights after creation under v2.0 rules. This distinction is crucial and a major change from v1.0.
* *Proof-Based Operations:* Explain that DID lifecycle operations (Create, Update, Revoke, Deactivate) require a cryptographic `proof` within the HCS message, generated by a key authorized by the designated `controller`. Detail the purpose and verification of these proofs.
* *HCS Role vs. Controller Role:* Define HCS (via `topic-id`) as the immutable message transport/ordering layer. Explain that the HCS `submitKey` grants topic write permission, which is separate from the DID's logical `controller` authorization required for valid state changes via proofs.
* *Resolver Logic:* Explain the v2.0 resolution process, emphasizing the need for resolvers to fetch HCS messages, validate proofs against the current controller, and reconstruct the DID document state sequentially.
* *SDK Examples:* Provide practical SDK code examples for core workflows:
** Creating a DID specifying the initial `controller` and generating the initial proof.
** Resolving a DID according to v2.0 logic (including proof validation).
** Authorizing an Update/Revoke/Deactivate operation by generating the `proof` as the `controller`.
** Submitting operations via HCS (including the `message` and `proof` structure).
* *Documentation Clarity:* Ensure documentation prominently clarifies the non-controlling role of the `<base58-key>` in v2.0 and highlights the mandatory proof validation step for resolvers. Structure guides around the key principles and lifecycle operations (Create, Resolve, Update, Revoke, Deactivate).

== Reference Implementation

A reference implementation for the Hedera DID Method v2.0, demonstrating how to create, resolve, update, and deactivate DIDs according to this specification using JavaScript, is being developed. The work-in-progress SDK is available at: link:https://github.com/Swiss-Digital-Assets-Institute/hashgraph-did-sdk-js[https://github.com/Swiss-Digital-Assets-Institute/hashgraph-did-sdk-js].

== References

* link:https://www.w3.org/TR/did-core/[Decentralized Identifiers (DIDs) v1.0 - W3C Recommendation]
* link:https://github.com/hashgraph/did-method/[Hedera DID Method v1.0 Specification (For historical context)]

== Copyright/license

This document is licensed under the Apache License, Version 2.0 -- see link:https://www.apache.org/licenses/LICENSE-2.0[Apache License, Version 2.0]
