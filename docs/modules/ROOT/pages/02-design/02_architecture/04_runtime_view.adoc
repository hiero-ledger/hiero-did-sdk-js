=== Level 4: Runtime View

This diagram illustrates the runtime interactions between the components of the Hiero DID SDK, a dApp developer, and the Hedera network during a typical DID management workflow. It shows the sequence of operations and how data flows between the components.

image::runtime-view-diagram.png[]

==== Components

* **dApp Developer:** The end developer who interacts with the SDK to manage decentralized identifiers (DIDs) and related credentials.

* **Hiero DID SDK:** The software development kit consisting of key components that handle DID lifecycle, messaging, cryptography, and ledger interactions:

  * **Registrar:** Handles creation, update, deactivation, and resolution of DIDs at runtime.
  * **Resolver:** Resolves DID Documents upon developer’s request.
  * **Signer:** Signs DID messages and transactions to ensure integrity and authenticity.
  * **Publisher:** Signs and publishes transactions to the Hedera Consensus Service (HCS).
  * **HcsService:** Coordinates Hedera Consensus Service objects handling and initializes underlying services.
  * **HcsTopicService:** Manages HCS topics lifecycle (create, update, delete) used for DID communication.
  * **HcsMessageService:** Sends messages to and retrieves messages from HCS topics.
  * **HcsFileService:** Handles chunked file submission and retrieval with compression and verification.
  * **HederaClientService:** Provides configured Hedera SDK clients for interacting with Hedera networks.
  * **Cache Service:** Caches frequently used data to enhance performance.
  * **Crypto Library:** Provides cryptographic utilities (e.g., SHA-256 hashing).
  * **Zstd Compression:** Offers compression and decompression using the Zstandard algorithm.
  * **AnoncredsRegistry:** Manages decentralized anonymous credentials (AnonCreds) data lifecycle on Hedera.

* **Hedera Consensus Service (topic):** The Hedera network service providing publish/subscribe messaging on topics.

* **Hedera Node:** The blockchain node gateway handling transaction submission and state queries.

==== Runtime Workflow Interactions

1. **DID Operation Initiation:** The dApp developer triggers a DID operation (create, update, deactivate, or resolve) via the **Registrar** or **Resolver** components.

2. **Signer Interaction:** For operations involving DID messages, the **Registrar** requests the **Signer** to cryptographically sign the messages, ensuring authenticity.

3. **HCS Object Management:** The **Registrar** invokes **HcsService**, which orchestrates interactions with **HcsTopicService**, **HcsMessageService**, and **HcsFileService** to handle topic creation, message sending, or file storage.

4. **Transaction Preparation and Publishing:** The **Publisher** signs and publishes the constructed transactions (including DID Documents or credential data encoded as messages or files) to the **Hedera Consensus Service (topic)**.

5. **Ledger Interaction:** The **Hedera Consensus Service** communicates with one or more **Hedera Nodes** to persist, order, and propagate the transactions.

6. **Caching for Efficiency:** The **Cache Service** supports multiple components (Registrar, Resolver, HCS services) by caching metadata, topic information, messages, or DID documents to reduce redundant network calls.

7. **Message and File Retrieval:** The **Resolver**, when resolving DID Documents or credentials, uses **HcsMessageService** and **HcsFileService** to retrieve messages and files from topics, decompressing via **Zstd Compression** and verifying integrity with the **Crypto Library**.

8. **Hedera Client Usage:** All interactions with the Hedera network (making calls, submitting transactions) pass through clients managed by **HederaClientService**, which handles multi-network configurations and client lifecycle.

9. **Anoncreds Data Management:** The **AnoncredsRegistry** uses **HcsService** and related messaging/file services to register schemas, credential definitions, revocation registries, and status lists, ensuring decentralized credential management atop Hedera.

==== Data Flow Summary

- Developer → Registrar/Resolver: Triggers DID management or resolution.

- Registrar → Signer: Signs DID messages.

- Registrar → HcsService → (HcsTopicService, HcsMessageService, HcsFileService): Manages Hedera topics, messages, files.

- Publisher → Hedera Topic Service: Publishes signed transactions.

- Hedera Topic Service ↔ Hedera Node: Processes transactions and returns state.

- Resolver → HcsMessageService/HcsFileService → Cache: Retrieves and caches DID documents and credential data.

- All Ledger interactions → HederaClientService: Provides configured clients for network operations.

- AnoncredsRegistry ↔ HcsService: Manages AnonCreds lifecycle on ledger.

