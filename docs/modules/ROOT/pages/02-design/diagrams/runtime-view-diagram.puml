@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Hiero DID SDK Runtime View

Person_Ext(developer, "dApp Developer", "Builds dApps with decentralized identity (not just identifiers)")

System_Boundary(c1, "Hiero DID SDK") {

  Component(registrar, "Registrar", "DID create, update, and deactivate operations")
  Component(resolver, "Resolver", "Resolves DID Document")
  Component(hcsService, "HcsService", "Manages Hedera Consensus Service objects")
  Component(anoncredsRegistry, "HederaAnoncredsRegistry", "Manages AnonCreds schemas, credential defs, revocation registries")

  Component(signer, "Signer", "Signs DID Message")
  Component(verifier, "Verifier", "Verifies DID Message")

  Component(publisher, "Publisher", "Signs & Publishes Transaction")

  Component(hashicorpSigner, "HashiCorp Signer", "Signs DID Message")
  Component(hashicorpVerifier, "HashiCorp Verifier", "Verifies DID Message")

  Component(hcsTopicService, "HcsTopicService", "Manages Hedera Consensus Service topics")
  Component(hcsMessageService, "HcsMessageService", "Sends and retrieves messages from topics")
  Component(hcsFileService, "HcsFileService", "Stores and resolves files according to HCS-1 standard")
}

System_Ext(hashicorp, "HashiCorp Vault", "External KMS used by Vault signer/verifier")

System_Ext(topic, "Hedera Consensus Service", "Service providing decentralized, auditable logs of immutable and timestamped events (messages)")
System_Ext(hedera, "Hedera Node", "Gateway to the Hedera network")

' Developer interactions
Rel(developer, registrar, "dApp developers use Registrar to create, update, and deactivate DIDs")
Rel(developer, resolver, "Developers resolve DID Documents using Resolver")
Rel(developer, hcsService, "Developers leverage HcsService for Hedera Consensus Service object management")
Rel(developer, anoncredsRegistry, "Developers manage AnonCreds resources using HederaAnoncredsRegistry")

' Registrar dependencies
Rel(registrar, signer, "Registrar requests cryptographic signing of DID messages from Signer")
Rel(registrar, verifier, "Registrar requests cryptographic verification of DID messages from Verifier")

Rel_R(registrar, publisher, "Registrar relies on Publisher to sign and send transactions to Hedera")

Rel(registrar, hashicorpSigner, "Registrar requests cryptographic signing of DID messages from HashiCorp Signer")
Rel(registrar, hashicorpVerifier, "Registrar requests cryptographic verification of DID messages from HashiCorp Verifier")

Rel(hashicorpSigner, hashicorp, "HashiCorp Signer requests cryptographic signing of DID messages")
Rel_R(hashicorpVerifier, hashicorp, "HashiCorp Verifier requests cryptographic verification of DID messages")

' Transaction submission
Rel(publisher, topic, "Publisher submits signed transactions to Hedera Consensus Service topics")

' DID Document retrieval
Rel(resolver, topic, "Resolver reads DID Documents from Hedera Consensus Service topics")

' HCS service internal usage
Rel(hcsService, hcsTopicService, "HcsService manages topic lifecycle via HcsTopicService")
Rel(hcsService, hcsMessageService, "HcsService manages messaging via HcsMessageService")
Rel(hcsService, hcsFileService, "HcsService manages files via HcsFileService")

' Topic communication with Hedera network
Rel(hcsMessageService, topic, "HcsMessageService sends and fetches messages on topics")
Rel(hcsFileService, topic, "HcsFileService manages file chunks in topics")
Rel(hcsTopicService, topic, "HcsTopicService handles topic lifecycle on Hedera")

' Anoncreds registry relies on HCS service
Rel_L(anoncredsRegistry, hcsService, "AnoncredsRegistry uses HcsService for interaction with Hedera")

' Hedera network infrastructure
Rel(topic, hedera, "Hedera Consensus Service topics interact with Hedera Nodes to process transactions")

@enduml
